(function($){var Constants={PLUGIN_NAME:"timer",TIMER_RUNNING:"running",TIMER_PAUSED:"paused",TIMER_REMOVED:"removed",DAYINSECONDS:86400};function _secondsToTimeObj(totalSeconds){var totalMinutes;totalSeconds=totalSeconds||0;totalMinutes=Math.floor(totalSeconds/60);return{days:totalSeconds>=Constants.DAYINSECONDS?Math.floor(totalSeconds/Constants.DAYINSECONDS):0,hours:totalSeconds>=3600?Math.floor(totalSeconds%Constants.DAYINSECONDS/3600):0,totalMinutes:totalMinutes,minutes:totalSeconds>=60?Math.floor(totalSeconds%3600/60):totalMinutes,seconds:totalSeconds%60,totalSeconds:totalSeconds}}function _paddedValue(num){num=parseInt(num,10);return(num<10&&"0")+num}function getDefaultConfig(){return{seconds:0,editable:false,duration:null,callback:function(){console.log("Time up!")},repeat:false,countdown:false,format:null,updateFrequency:500}}function unixSeconds(){return Math.round((Date.now?Date.now():(new Date).getTime())/1e3)}function secondsToPrettyTime(seconds){var timeObj=_secondsToTimeObj(seconds);if(timeObj.days){return timeObj.days+":"+_paddedValue(timeObj.hours)+":"+_paddedValue(timeObj.minutes)+":"+_paddedValue(timeObj.seconds)}if(timeObj.hours){return timeObj.hours+":"+_paddedValue(timeObj.minutes)+":"+_paddedValue(timeObj.seconds)}var prettyTime="";if(timeObj.minutes){prettyTime=timeObj.minutes+":"+_paddedValue(timeObj.seconds)+" min"}else{prettyTime=timeObj.seconds+" sec"}return prettyTime}function secondsToFormattedTime(seconds,formattedTime){var timeObj=_secondsToTimeObj(seconds);var formatDef=[{identifier:"%d",value:timeObj.days},{identifier:"%h",value:timeObj.hours},{identifier:"%m",value:timeObj.minutes},{identifier:"%s",value:timeObj.seconds},{identifier:"%g",value:timeObj.totalMinutes},{identifier:"%t",value:timeObj.totalSeconds},{identifier:"%D",value:_paddedValue(timeObj.days)},{identifier:"%H",value:_paddedValue(timeObj.hours)},{identifier:"%M",value:_paddedValue(timeObj.minutes)},{identifier:"%S",value:_paddedValue(timeObj.seconds)},{identifier:"%G",value:_paddedValue(timeObj.totalMinutes)},{identifier:"%T",value:_paddedValue(timeObj.totalSeconds)}];for(var i=0;i<formatDef.length;i++){formattedTime=formattedTime.replace(formatDef[i].identifier,formatDef[i].value)}return formattedTime}function durationTimeToSeconds(timeFormat){if(!isNaN(Number(timeFormat))){return timeFormat}timeFormat=timeFormat.toLowerCase();var days=timeFormat.match(/\d+d/);var hrs=timeFormat.match(/\d+h/);var mins=timeFormat.match(/\d+m/);var secs=timeFormat.match(/\d+s/);if(!days&&!hrs&&!mins&&!secs){throw new Error("Invalid string passed in durationTimeToSeconds!")}var seconds=0;if(days){seconds+=Number(days[0].replace("d",""))*Constants.DAYINSECONDS}if(hrs){seconds+=Number(hrs[0].replace("h",""))*3600}if(mins){seconds+=Number(mins[0].replace("m",""))*60}if(secs){seconds+=Number(secs[0].replace("s",""))}return seconds}function prettyTimeToSeconds(editedTime){var arr,time;if(editedTime.indexOf("sec")>0){time=Number(editedTime.replace(/\ssec/g,""))}else if(editedTime.indexOf("min")>0){editedTime=editedTime.replace(/\smin/g,"");arr=editedTime.split(":");time=Number(arr[0]*60)+Number(arr[1])}else if(editedTime.match(/\d{1,2}:\d{2}:\d{2}:\d{2}/)){arr=editedTime.split(":");time=Number(arr[0]*Constants.DAYINSECONDS)+Number(arr[1]*3600)+Number(arr[2]*60)+Number(arr[3])}else if(editedTime.match(/\d{1,2}:\d{2}:\d{2}/)){arr=editedTime.split(":");time=Number(arr[0]*3600)+Number(arr[1]*60)+Number(arr[2])}return time}function setState(timerInstance,newState){timerInstance.state=newState;$(timerInstance.element).data("state",newState)}function makeEditable(timerInstance){$(timerInstance.element).on("focus",function(){timerInstance.pause()});$(timerInstance.element).on("blur",function(){timerInstance.totalSeconds=prettyTimeToSeconds($(timerInstance.element)[timerInstance.html]());timerInstance.resume()})}function intervalHandler(timerInstance){timerInstance.totalSeconds=unixSeconds()-timerInstance.startTime;if(timerInstance.config.countdown){timerInstance.totalSeconds=timerInstance.config.duration-timerInstance.totalSeconds;if(timerInstance.totalSeconds===0){clearInterval(timerInstance.intervalId);setState(timerInstance,Constants.TIMER_STOPPED);timerInstance.config.callback();$(timerInstance.element).data("seconds")}timerInstance.render();return}timerInstance.render();if(!timerInstance.config.duration){return}if(timerInstance.totalSeconds>0&&timerInstance.totalSeconds%timerInstance.config.duration===0){if(timerInstance.config.callback){timerInstance.config.callback()}if(!timerInstance.config.repeat){clearInterval(timerInstance.intervalId);setState(timerInstance,Constants.TIMER_STOPPED);timerInstance.config.duration=null}}}var utils={getDefaultConfig:getDefaultConfig,unixSeconds:unixSeconds,secondsToPrettyTime:secondsToPrettyTime,secondsToFormattedTime:secondsToFormattedTime,durationTimeToSeconds:durationTimeToSeconds,prettyTimeToSeconds:prettyTimeToSeconds,setState:setState,makeEditable:makeEditable,intervalHandler:intervalHandler};function Timer(element,config){this.element=element;this.originalConfig=$.extend({},config);this.totalSeconds=0;this.intervalId=null;this.html="html";if(element.tagName==="INPUT"||element.tagName==="TEXTAREA"){this.html="val"}this.config=utils.getDefaultConfig();if(config.duration){config.duration=utils.durationTimeToSeconds(config.duration)}if(typeof config!=="string"){this.config=$.extend(this.config,config)}if(this.config.seconds){this.totalSeconds=this.config.seconds}if(this.config.editable){utils.makeEditable(this)}this.startTime=utils.unixSeconds()-this.totalSeconds;if(this.config.duration&&this.config.repeat&&this.config.updateFrequency<1e3){this.config.updateFrequency=1e3}if(this.config.countdown){if(!this.config.duration){throw new Error("Countdown option set without duration!")}if(this.config.editable){throw new Error("Cannot set editable on a countdown timer!")}this.config.startTime=utils.unixSeconds()-this.config.duration;this.totalSeconds=this.config.duration}}Timer.prototype.start=function(){if(this.state!==Constants.TIMER_RUNNING){utils.setState(this,Constants.TIMER_RUNNING);this.render();this.intervalId=setInterval(utils.intervalHandler.bind(null,this),this.config.updateFrequency)}};Timer.prototype.pause=function(){if(this.state===Constants.TIMER_RUNNING){utils.setState(this,Constants.TIMER_PAUSED);clearInterval(this.intervalId)}};Timer.prototype.resume=function(){if(this.state===Constants.TIMER_PAUSED){utils.setState(this,Constants.TIMER_RUNNING);if(this.config.countdown){this.startTime=utils.unixSeconds()-this.config.duration+this.totalSeconds}else{this.startTime=utils.unixSeconds()-this.totalSeconds}this.intervalId=setInterval(utils.intervalHandler.bind(null,this),this.config.updateFrequency)}};Timer.prototype.remove=function(){clearInterval(this.intervalId);utils.setState(this,Constants.TIMER_REMOVED);$(this.element).data(Constants.PLUGIN_NAME,null);$(this.element).data("seconds",null)};Timer.prototype.reset=function(){var originalConfig=this.originalConfig;this.remove();$(this.element).timer(originalConfig)};Timer.prototype.render=function(){if(this.config.format){$(this.element)[this.html](utils.secondsToFormattedTime(this.totalSeconds,this.config.format))}else{$(this.element)[this.html](utils.secondsToPrettyTime(this.totalSeconds))}$(this.element).data("seconds",this.totalSeconds)};$.fn.timer=function(options){options=options||"start";return this.each(function(){if(!($.data(this,Constants.PLUGIN_NAME)instanceof Timer)){$.data(this,Constants.PLUGIN_NAME,new Timer(this,options))}var instance=$.data(this,Constants.PLUGIN_NAME);if(typeof options==="string"){if(typeof instance[options]==="function"){instance[options]()}}else{instance.start()}})}})(jQuery);