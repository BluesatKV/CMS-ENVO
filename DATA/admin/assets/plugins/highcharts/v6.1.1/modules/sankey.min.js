(function(a){"object"===typeof module&&module.exports?module.exports=a:a(Highcharts)})(function(a){(function(g){var b=g.defined,c=g.each,h=g.extend,d=g.seriesType,i=g.Point;d("sankey","column",{colorByPoint:!0,curveFactor:0.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){return""},inside:!0},linkOpacity:0.5,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1}},tooltip:{followPointer:!0,headerFormat:'\x3cspan style\x3d"font-size: 0.85em"\x3e{series.name}\x3c/span\x3e\x3cbr/\x3e',pointFormat:"{point.fromNode.name} \u2192 {point.toNode.name}: \x3cb\x3e{point.weight}\x3c/b\x3e\x3cbr/\x3e",nodeFormat:"{point.name}: \x3cb\x3e{point.sum}\x3c/b\x3e\x3cbr/\x3e"}},{isCartesian:!1,forceDL:!0,createNode:function(e){function f(m,l){return g.find(m,function(n){return n.id===l})}var k=f(this.nodes,e),j;k||(j=this.options.nodes&&f(this.options.nodes,e),k=(new i).init(this,h({className:"highcharts-node",isNode:!0,id:e,y:1},j)),k.linksTo=[],k.linksFrom=[],k.formatPrefix="node",k.name=k.name||k.id,k.getSum=function(){var m=0,l=0;c(k.linksTo,function(n){m+=n.weight});c(k.linksFrom,function(n){l+=n.weight});return Math.max(m,l)},k.offset=function(m,l){for(var n=0,o=0;o<k[l].length;o++){if(k[l][o]===m){return n}n+=k[l][o].weight}},k.hasShape=function(){var l=0;c(k.linksTo,function(m){m.outgoing&&l++});return !k.linksTo.length||l!==k.linksTo.length},this.nodes.push(k));return k},createNodeColumn:function(){var e=this.chart,f=[],j=this.options.nodePadding;f.sum=function(){var k=0;c(this,function(l){k+=l.getSum()});return k};f.offset=function(k,l){for(var n=0,m=0;m<f.length;m++){if(f[m]===k){return n+(k.options.offset||0)}n+=f[m].getSum()*l+j}};f.top=function(m){for(var k=0,l=0;l<f.length;l++){0<l&&(k+=j),k+=f[l].getSum()*m}return(e.plotSizeY-k)/2};return f},createNodeColumns:function(){var e=[];c(this.nodes,function(f){var l=-1,k,j;if(!g.defined(f.options.column)){if(0===f.linksTo.length){f.column=0}else{for(k=0;k<f.linksTo.length;k++){j=f.linksTo[0],j.fromNode.column>l&&(l=j.fromNode.column)}f.column=l+1}}e[f.column]||(e[f.column]=this.createNodeColumn());e[f.column].push(f)},this);return e},pointAttribs:function(e,f){var j=this.options.linkOpacity;f&&(j=this.options.states[f].linkOpacity||j);return{fill:e.isNode?e.color:g.color(e.color).setOpacity(j).get()}},generatePoints:function(){var e={};g.Series.prototype.generatePoints.call(this);this.nodes||(this.nodes=[]);this.colorCounter=0;c(this.nodes,function(f){f.linksFrom.length=0;f.linksTo.length=0});c(this.points,function(f){b(f.from)&&(e[f.from]||(e[f.from]=this.createNode(f.from)),e[f.from].linksFrom.push(f),f.fromNode=e[f.from],f.color=f.options.color||e[f.from].color);b(f.to)&&(e[f.to]||(e[f.to]=this.createNode(f.to)),e[f.to].linksTo.push(f),f.toNode=e[f.to]);f.name=f.name||f.id},this)},translate:function(){this.processedXData||this.processData();this.generatePoints();this.nodeColumns=this.createNodeColumns();var r=this.chart,s=r.inverted,q=this.options,o=0,n=q.nodeWidth,l=this.nodeColumns,j=(r.plotSizeX-n)/(l.length-1),f=(s?-j:j)*q.curveFactor,k=Infinity;c(this.nodeColumns,function(e){k=Math.min(k,(r.plotSizeY-(e.length-1)*q.nodePadding)/e.sum())});c(this.nodeColumns,function(e){c(e,function(u){var w=u.getSum(),m=w*k,p=e.top(k)+e.offset(u,k),t=s?r.plotSizeX-o:o;u.sum=w;u.shapeType="rect";u.shapeArgs=s?{x:t-n,y:r.plotSizeY-p-m,width:n,height:m}:{x:t,y:p,width:n,height:m};u.shapeArgs.display=u.hasShape()?"":"none";u.plotY=1;c(u.linksFrom,function(ah){var af=ah.weight*k,ad=u.offset(ah,"linksFrom")*k,ad=p+ad,ae=ah.toNode,ag=l[ae.column].top(k)+ae.offset(ah,"linksTo")*k+l[ae.column].offset(ae,k),Z=n,ae=ae.column*j,T=ah.outgoing;s&&(ad=r.plotSizeY-ad,ag=r.plotSizeY-ag,ae=r.plotSizeX-ae,Z=-Z,af=-af);ah.shapeType="path";if(ae>o){ah.shapeArgs={d:["M",t+Z,ad,"C",t+Z+f,ad,ae-f,ag,ae,ag,"L",ae+(T?Z:0),ag+af/2,"L",ae,ag+af,"C",ae-f,ag+af,t+Z+f,ad+af,t+Z,ad+af,"z"]}}else{var T=ae-20-af,R=ae-20,ac=ae,P=t+Z,W=P+20,X=W+af,U=ad,N=ad+af,S=N+20,ab=S+(r.plotHeight-ad-af),Y=ab+20,V=Y+af,Q=ag,aa=Q+af,O=aa+20,G=Y+0.7*af,D=ac-0.7*af,C=P+0.7*af;ah.shapeArgs={d:["M",P,U,"C",C,U,X,N-0.7*af,X,S,"L",X,ab,"C",X,G,C,V,P,V,"L",ac,V,"C",D,V,T,G,T,ab,"L",T,O,"C",T,aa-0.7*af,D,Q,ac,Q,"L",ac,aa,"C",R,aa,R,aa,R,O,"L",R,ab,"C",R,Y,R,Y,ac,Y,"L",P,Y,"C",W,Y,W,Y,W,ab,"L",W,S,"C",W,N,W,N,P,N,"z"]}}ah.dlBox={x:t+(ae-t+Z)/2,y:ad+(ag-ad)/2,height:af,width:0};ah.y=ah.plotY=1;ah.color||(ah.color=u.color)})});o+=j},this)},render:function(){var e=this.points;this.points=this.points.concat(this.nodes);g.seriesTypes.column.prototype.render.call(this);this.points=e},animate:g.Series.prototype.animate},{getClassName:function(){return"highcharts-link "+i.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"===typeof this.weight}})})(a)});