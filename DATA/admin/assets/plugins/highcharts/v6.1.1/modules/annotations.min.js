(function(a){"object"===typeof module&&module.exports?module.exports=a:a(Highcharts)})(function(a){(function(ae){var ac=ae.merge,ad=ae.addEvent,R=ae.extend,ab=ae.each,V=ae.isString,i=ae.isNumber,aa=ae.defined,U=ae.isObject,S=ae.inArray,T=ae.erase,Q=ae.find,s=ae.format,t=ae.pick,Z=ae.objectEach,r=ae.uniqueKey,k=ae.doc,h=ae.splat,g=ae.destroyObjectProperties,e=ae.grep,Y=ae.Tooltip.prototype,d=ae.Series.prototype,W=ae.Chart.prototype,c={arrow:{tagName:"marker",render:!1,id:"arrow",refY:5,refX:5,markerWidth:10,markerHeight:10,children:[{tagName:"path",d:"M 0 0 L 10 5 L 0 10 Z",strokeWidth:0}]}},X={markerSetter:function(f){return function(l){this.attr(f,"url(#"+l+")")}}};R(X,{markerEndSetter:X.markerSetter("marker-end"),markerStartSetter:X.markerSetter("marker-start")});ae.SVGRenderer.prototype.definition=function(l){function f(n,q){var p;ab(h(n),function(u){var v=m.createElement(u.tagName),w={};Z(u,function(y,x){"tagName"!==x&&"children"!==x&&"textContent"!==x&&(w[x]=y)});v.attr(w);v.add(q||m.defs);u.textContent&&v.element.appendChild(k.createTextNode(u.textContent));f(u.children||[],v);p=v});return p}var m=this;return f(l)};ae.SVGRenderer.prototype.addMarker=function(l,f){var n={id:l},m={stroke:f.color||"none",fill:f.color||"rgba(0, 0, 0, 0.75)"};n.children=ae.map(f.children,function(p){return ac(m,p)});f=this.definition(ac({markerWidth:20,markerHeight:20,refX:0,refY:0,orient:"auto"},f,n));f.id=l;return f};var o=ae.MockPoint=function(l,f){this.mock=!0;this.series={visible:!0,chart:l,getPlotBox:d.getPlotBox};this.init(l,f)},b=ae.mockPoint=function(l,f){return new o(l,f)};o.prototype={init:function(l,f){var n=f.xAxis,n=aa(n)?l.xAxis[n]||l.get(n):null,m=f.yAxis;l=aa(m)?l.yAxis[m]||l.get(m):null;n?(this.x=f.x,this.series.xAxis=n):this.plotX=f.x;l?(this.y=f.y,this.series.yAxis=l):this.plotY=f.y},translate:function(){var l=this.series,f=l.xAxis,l=l.yAxis;f&&(this.plotX=f.toPixels(this.x,!0));l&&(this.plotY=l.toPixels(this.y,!0));this.isInside=this.isInsidePane()},alignToBox:function(l){l&&this.translate();l=this.plotX;var f=this.plotY,m;this.series.chart.inverted&&(m=l,l=f,f=m);return[l,f,0,0]},getLabelConfig:function(){return{x:this.x,y:this.y,point:this}},isInsidePane:function(){var l=this.plotX,f=this.plotY,p=this.series.xAxis,m=this.series.yAxis,n=!0;p&&(n=aa(l)&&0<=l&&l<=p.len);m&&(n=n&&aa(f)&&0<=f&&f<=m.len);return n}};ae.defaultOptions.annotations=[];var j=ae.Annotation=function(l,f){this.chart=l;this.labels=[];this.shapes=[];this.userOptions=f;this.options=ac(this.defaultOptions,f);this.init(l,f)};j.prototype={shapesWithoutBackground:["connector"],attrsMap:{backgroundColor:"fill",borderColor:"stroke",borderWidth:"stroke-width",dashStyle:"dashstyle",strokeWidth:"stroke-width",stroke:"stroke",fill:"fill",zIndex:"zIndex",width:"width",height:"height",borderRadius:"r",r:"r",padding:"padding"},defaultOptions:{visible:!0,labelOptions:{align:"center",allowOverlap:!1,backgroundColor:"rgba(0, 0, 0, 0.75)",borderColor:"black",borderRadius:3,borderWidth:1,className:"",crop:!1,formatter:function(){return aa(this.y)?this.y:"Annotation label"},overflow:"justify",padding:5,shadow:!1,shape:"callout",style:{fontSize:"11px",fontWeight:"normal",color:"contrast"},useHTML:!1,verticalAlign:"bottom",x:0,y:-16},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1,fill:"rgba(0, 0, 0, 0.75)",r:0},zIndex:6},init:function(){var f=this;ab(this.options.labels||[],this.initLabel,this);ab(this.options.shapes||[],this.initShape,this);this.labelCollector=function(){return e(f.labels,function(l){return !l.options.allowOverlap})};this.chart.labelCollectors.push(this.labelCollector)},redraw:function(){this.group||this.render();this.redrawItems(this.shapes);this.redrawItems(this.labels)},redrawItems:function(l){for(var f=l.length;f--;){this.redrawItem(l[f])}},render:function(){var l=this.chart.renderer,f=this.group=l.g("annotation").attr({zIndex:this.options.zIndex,visibility:this.options.visible?"visible":"hidden"}).add();this.shapesGroup=l.g("annotation-shapes").add(f);this.labelsGroup=l.g("annotation-labels").attr({translateX:0,translateY:0}).add(f);this.shapesGroup.clip(this.chart.plotBoxClip)},setVisible:function(l){var f=this.options;l=t(l,!f.visible);this.group.attr({visibility:l?"visible":"hidden"});f.visible=l},destroy:function(){var l=this.chart,f=function(m){m.destroy()};T(this.chart.labelCollectors,this.labelCollector);ab(this.labels,f);ab(this.shapes,f);g(this,l)},initShape:function(l){var f=this.chart.renderer;l=ac(this.options.shapeOptions,l);var n=this.attrsFromOptions(l),m=f[l.type]?l.type:"rect",f=f[m](0,-9000000000,0,0);f.points=[];f.type=m;f.options=l;f.itemType="shape";"path"===m&&R(f,{markerStartSetter:X.markerStartSetter,markerEndSetter:X.markerEndSetter,markerStart:X.markerStart,markerEnd:X.markerEnd});f.attr(n);l.className&&f.addClass(l.className);this.shapes.push(f)},initLabel:function(l){l=ac(this.options.labelOptions,l);var f=this.attrsFromOptions(l),m=this.chart.renderer.label("",0,-9000000000,l.shape,null,null,l.useHTML,null,"annotation-label");m.points=[];m.options=l;m.itemType="label";m.labelrank=l.labelrank;m.annotation=this;m.attr(f);f=l.style;"contrast"===f.color&&(f.color=this.chart.renderer.getContrast(-1<S(l.shape,this.shapesWithoutBackground)?"#FFFFFF":l.backgroundColor));m.css(f).shadow(l.shadow);l.className&&m.addClass(l.className);this.labels.push(m)},redrawItem:function(l){var f=this.linkPoints(l),p=l.options,m,n=this.chart.time;f.length?(l.parentGroup||this.renderItem(l),"label"===l.itemType&&(m=p.format||p.text,l.attr({text:m?s(m,f[0].getLabelConfig(),n):p.formatter.call(f[0])})),"path"===l.type?this.redrawPath(l):this.alignItem(l,!l.placed)):this.destroyItem(l)},destroyItem:function(f){T(this[f.itemType+"s"],f);f.destroy()},pointItem:function(l,f){f&&null!==f.series||(U(l)?f=b(this.chart,l):V(l)&&(f=this.chart.get(l)||null));return f},linkPoints:function(l){var f=l.options.points||l.options.point&&ae.splat(l.options.point),q=l.points,n=f&&f.length,p,m;for(p=0;p<n;p++){m=this.pointItem(f[p],q[p]);if(!m){return l.points=[]}q[p]=m}return q},alignItem:function(l,f){var n=this.itemAnchor(l,l.points[0]),m=this.itemPosition(l,n);m?(l.alignAttr=m,l.placed=!0,m.anchorX=n.absolutePosition.x,m.anchorY=n.absolutePosition.y,l[f?"attr":"animate"](m)):(l.placed=!1,l.attr({x:0,y:-9000000000}))},redrawPath:function(y,x){var w=y.points,u=y["stroke-width"]||1,v=["M"],q=0,n=0,p=w&&w.length,m,l;if(p){do{l=w[q],m=this.itemAnchor(y,l).absolutePosition,v[++n]=m.x,v[++n]=m.y,m=n%5,0===m&&(v[m+1]===v[m+4]&&(v[m+1]=v[m+4]=Math.round(v[m+1])-u%2/2),v[m+2]===v[m+5]&&(v[m+2]=v[m+5]=Math.round(v[m+2])+u%2/2)),q<p-1&&(v[++n]="L"),l=l.series.visible}while(++q<p&&l)}if(l){y[x?"attr":"animate"]({d:v})}else{y.attr({d:"M 0 -9000000000"})}y.placed=l},renderItem:function(f){f.add("label"===f.itemType?this.labelsGroup:this.shapesGroup);this.setItemMarkers(f)},setItemMarkers:function(m){var l=m.options,u=this.chart,p=u.options.defs,q=l.fill,n=aa(q)&&"none"!==q?q:l.stroke;ab(["markerStart","markerEnd"],function(y){var x=l[y],f,w,v;if(x){for(v in p){if(f=p[v],x===f.id&&"marker"===f.tagName){w=f;break}}w&&(x=m[y]=u.renderer.addMarker((l.id||r())+"-"+w.id,ac(w,{color:n})),m.attr(y,x.attr("id")))}})},itemAnchor:function(l,f){l=f.series.getPlotBox();f=f.mock?f.alignToBox(!0):Y.getAnchor.call({chart:this.chart},f);f={x:f[0],y:f[1],height:f[2]||0,width:f[3]||0};return{relativePosition:f,absolutePosition:ac(f,{x:f.x+l.translateX,y:f.y+l.translateY})}},itemPosition:function(m,l){var w=this.chart,u=m.points[0],v=m.options,q=l.absolutePosition,n=l.relativePosition,p;if(l=u.series.visible&&o.prototype.isInsidePane.call(u)){aa(v.distance)||v.positioner?p=(v.positioner||Y.getPosition).call({chart:w,distance:t(v.distance,16)},m.width,m.height,{plotX:n.x,plotY:n.y,negative:u.negative,ttBelow:u.ttBelow,h:n.height||n.width}):(u={x:q.x,y:q.y,width:0,height:0},p=this.alignedPosition(R(v,{width:m.width,height:m.height}),u),"justify"===m.options.overflow&&(p=this.alignedPosition(this.justifiedOptions(m,v,p),u))),v.crop&&(v=p.x-w.plotLeft,u=p.y-w.plotTop,l=w.isInsidePlot(v,u)&&w.isInsidePlot(v+m.width,u+m.height))}return l?p:null},alignedPosition:function(m,l){var w=m.align,u=m.verticalAlign,v=(l.x||0)+(m.x||0),q=(l.y||0)+(m.y||0),n,p;"right"===w?n=1:"center"===w&&(n=2);n&&(v+=(l.width-(m.width||0))/n);"bottom"===u?p=1:"middle"===u&&(p=2);p&&(q+=(l.height-(m.height||0))/p);return{x:Math.round(v),y:Math.round(q)}},justifiedOptions:function(x,w,v){var q=this.chart,u=w.align,p=w.verticalAlign,m=x.box?0:x.padding||0,n=x.getBBox();x={align:u,verticalAlign:p,x:w.x,y:w.y,width:x.width,height:x.height};w=v.x-q.plotLeft;var l=v.y-q.plotTop;v=w+m;0>v&&("right"===u?x.align="left":x.x=-v);v=w+n.width-m;v>q.plotWidth&&("left"===u?x.align="right":x.x=q.plotWidth-v);v=l+m;0>v&&("bottom"===p?x.verticalAlign="top":x.y=-v);v=l+n.height-m;v>q.plotHeight&&("top"===p?x.verticalAlign="bottom":x.y=q.plotHeight-v);return x},attrsFromOptions:function(l){var f=this.attrsMap,p={},m,n;for(m in l){(n=f[m])&&(p[n]=l[m])}return p}};ae.extend(W,{addAnnotation:function(l,f){var m=new j(this,l);this.annotations.push(m);this.options.annotations.push(l);t(f,!0)&&m.redraw();return m},removeAnnotation:function(l){var f=this.annotations,m=Q(f,function(n){return n.options.id===l});m&&(T(this.options.annotations,m.userOptions),T(f,m),m.destroy())},drawAnnotations:function(){var l=this.plotBoxClip,f=this.plotBox;l?l.attr(f):this.plotBoxClip=this.renderer.clipRect(f);ab(this.annotations,function(m){m.redraw()})}});W.callbacks.push(function(f){f.annotations=[];ab(f.options.annotations,function(l){f.annotations.push(new j(f,l))});f.drawAnnotations();ad(f,"redraw",f.drawAnnotations);ad(f,"destroy",function(){var l=f.plotBoxClip;l&&l.destroy&&l.destroy()})});ad(ae.Chart,"afterGetContainer",function(){this.options.defs=ac(c,this.options.defs||{});Z(this.options.defs,function(f){"marker"===f.tagName&&!1!==f.render&&this.renderer.addMarker(f.id,f)},this)});ae.SVGRenderer.prototype.symbols.connector=function(x,w,v,q,u){var p=u&&u.anchorX;u=u&&u.anchorY;var m,n,l=v/2;i(p)&&i(u)&&(m=["M",p,u],n=w-u,0>n&&(n=-q-n),n<v&&(l=p<x+v/2?n:v-n),u>w+q?m.push("L",x+l,w+q):u<w?m.push("L",x+l,w):p<x?m.push("L",x,w+q/2):p>x+v&&m.push("L",x+v,w+q/2));return m||[]}})(a)});