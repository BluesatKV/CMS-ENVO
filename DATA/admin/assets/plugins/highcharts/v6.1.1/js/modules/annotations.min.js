(function(a){"object"===typeof module&&module.exports?module.exports=a:a(Highcharts)})(function(a){(function(W){var U=W.merge,V=W.addEvent,r=W.extend,T=W.each,O=W.isString,d=W.isNumber,S=W.defined,N=W.isObject,t=W.erase,M=W.find,s=W.format,k=W.pick,o=W.uniqueKey,j=W.destroyObjectProperties,i=W.grep,R=W.Tooltip.prototype,g=W.Series.prototype,Q=W.Chart.prototype,c={arrow:{tagName:"marker",render:!1,id:"arrow",refY:5,refX:5,markerWidth:10,markerHeight:10,children:[{tagName:"path",d:"M 0 0 L 10 5 L 0 10 Z"}]}},P={markerSetter:function(f){return function(l){this.attr(f,"url(#"+l+")")}}};r(P,{markerEndSetter:P.markerSetter("marker-end"),markerStartSetter:P.markerSetter("marker-start")});W.SVGRenderer.prototype.addMarker=function(l,f){f=this.definition(U({markerWidth:20,markerHeight:20,refX:0,refY:0,orient:"auto"},f,{id:l}));f.id=l;return f};var h=W.MockPoint=function(l,f){this.mock=!0;this.series={visible:!0,chart:l,getPlotBox:g.getPlotBox};this.init(l,f)},b=W.mockPoint=function(l,f){return new h(l,f)};h.prototype={init:function(l,f){var n=f.xAxis,n=S(n)?l.xAxis[n]||l.get(n):null,m=f.yAxis;l=S(m)?l.yAxis[m]||l.get(m):null;n?(this.x=f.x,this.series.xAxis=n):this.plotX=f.x;l?(this.y=f.y,this.series.yAxis=l):this.plotY=f.y},translate:function(){var l=this.series,f=l.xAxis,l=l.yAxis;f&&(this.plotX=f.toPixels(this.x,!0));l&&(this.plotY=l.toPixels(this.y,!0));this.isInside=this.isInsidePane()},alignToBox:function(l){l&&this.translate();l=this.plotX;var f=this.plotY,m;this.series.chart.inverted&&(m=l,l=f,f=m);return[l,f,0,0]},getLabelConfig:function(){return{x:this.x,y:this.y,point:this}},isInsidePane:function(){var l=this.plotX,f=this.plotY,p=this.series.xAxis,m=this.series.yAxis,n=!0;p&&(n=S(l)&&0<=l&&l<=p.len);m&&(n=n&&S(f)&&0<=f&&f<=m.len);return n}};W.defaultOptions.annotations=[];var e=W.Annotation=function(l,f){this.chart=l;this.labels=[];this.shapes=[];this.userOptions=f;this.options=U(this.defaultOptions,f);this.init(l,f)};e.prototype={shapesWithoutBackground:["connector"],attrsMap:{zIndex:"zIndex",width:"width",height:"height",borderRadius:"r",r:"r",padding:"padding"},defaultOptions:{visible:!0,labelOptions:{align:"center",allowOverlap:!1,backgroundColor:"rgba(0, 0, 0, 0.75)",borderColor:"black",borderRadius:3,borderWidth:1,className:"",crop:!1,formatter:function(){return S(this.y)?this.y:"Annotation label"},overflow:"justify",padding:5,shadow:!1,shape:"callout",style:{fontSize:"11px",fontWeight:"normal",color:"contrast"},useHTML:!1,verticalAlign:"bottom",x:0,y:-16},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1,fill:"rgba(0, 0, 0, 0.75)",r:0},zIndex:6},init:function(){var f=this;T(this.options.labels||[],this.initLabel,this);T(this.options.shapes||[],this.initShape,this);this.labelCollector=function(){return i(f.labels,function(l){return !l.options.allowOverlap})};this.chart.labelCollectors.push(this.labelCollector)},redraw:function(){this.group||this.render();this.redrawItems(this.shapes);this.redrawItems(this.labels)},redrawItems:function(l){for(var f=l.length;f--;){this.redrawItem(l[f])}},render:function(){var l=this.chart.renderer,f=this.group=l.g("annotation").attr({zIndex:this.options.zIndex,visibility:this.options.visible?"visible":"hidden"}).add();this.shapesGroup=l.g("annotation-shapes").add(f);this.labelsGroup=l.g("annotation-labels").attr({translateX:0,translateY:0}).add(f);this.shapesGroup.clip(this.chart.plotBoxClip)},setVisible:function(l){var f=this.options;l=k(l,!f.visible);this.group.attr({visibility:l?"visible":"hidden"});f.visible=l},destroy:function(){var l=this.chart,f=function(m){m.destroy()};t(this.chart.labelCollectors,this.labelCollector);T(this.labels,f);T(this.shapes,f);j(this,l)},initShape:function(l){var f=this.chart.renderer;l=U(this.options.shapeOptions,l);var n=this.attrsFromOptions(l),m=f[l.type]?l.type:"rect",f=f[m](0,-9000000000,0,0);f.points=[];f.type=m;f.options=l;f.itemType="shape";"path"===m&&r(f,{markerStartSetter:P.markerStartSetter,markerEndSetter:P.markerEndSetter,markerStart:P.markerStart,markerEnd:P.markerEnd});f.attr(n);l.className&&f.addClass(l.className);this.shapes.push(f)},initLabel:function(l){l=U(this.options.labelOptions,l);var f=this.attrsFromOptions(l),m=this.chart.renderer.label("",0,-9000000000,l.shape,null,null,l.useHTML,null,"annotation-label");m.points=[];m.options=l;m.itemType="label";m.labelrank=l.labelrank;m.annotation=this;m.attr(f);l.className&&m.addClass(l.className);this.labels.push(m)},redrawItem:function(l){var f=this.linkPoints(l),p=l.options,m,n=this.chart.time;f.length?(l.parentGroup||this.renderItem(l),"label"===l.itemType&&(m=p.format||p.text,l.attr({text:m?s(m,f[0].getLabelConfig(),n):p.formatter.call(f[0])})),"path"===l.type?this.redrawPath(l):this.alignItem(l,!l.placed)):this.destroyItem(l)},destroyItem:function(f){t(this[f.itemType+"s"],f);f.destroy()},pointItem:function(l,f){f&&null!==f.series||(N(l)?f=b(this.chart,l):O(l)&&(f=this.chart.get(l)||null));return f},linkPoints:function(l){var f=l.options.points||l.options.point&&W.splat(l.options.point),q=l.points,n=f&&f.length,p,m;for(p=0;p<n;p++){m=this.pointItem(f[p],q[p]);if(!m){return l.points=[]}q[p]=m}return q},alignItem:function(l,f){var n=this.itemAnchor(l,l.points[0]),m=this.itemPosition(l,n);m?(l.alignAttr=m,l.placed=!0,m.anchorX=n.absolutePosition.x,m.anchorY=n.absolutePosition.y,l[f?"attr":"animate"](m)):(l.placed=!1,l.attr({x:0,y:-9000000000}))},redrawPath:function(y,x){var w=y.points,u=y["stroke-width"]||1,v=["M"],q=0,n=0,p=w&&w.length,m,l;if(p){do{l=w[q],m=this.itemAnchor(y,l).absolutePosition,v[++n]=m.x,v[++n]=m.y,m=n%5,0===m&&(v[m+1]===v[m+4]&&(v[m+1]=v[m+4]=Math.round(v[m+1])-u%2/2),v[m+2]===v[m+5]&&(v[m+2]=v[m+5]=Math.round(v[m+2])+u%2/2)),q<p-1&&(v[++n]="L"),l=l.series.visible}while(++q<p&&l)}if(l){y[x?"attr":"animate"]({d:v})}else{y.attr({d:"M 0 -9000000000"})}y.placed=l},renderItem:function(f){f.add("label"===f.itemType?this.labelsGroup:this.shapesGroup);this.setItemMarkers(f)},setItemMarkers:function(m){var l=m.options,u=this.chart,p=u.options.defs,q=l.fill,n=S(q)&&"none"!==q?q:l.stroke;T(["markerStart","markerEnd"],function(y){var x=l[y],f,w,v;if(x){for(v in p){if(f=p[v],x===f.id&&"marker"===f.tagName){w=f;break}}w&&(x=m[y]=u.renderer.addMarker((l.id||o())+"-"+w.id,U(w,{color:n})),m.attr(y,x.attr("id")))}})},itemAnchor:function(l,f){l=f.series.getPlotBox();f=f.mock?f.alignToBox(!0):R.getAnchor.call({chart:this.chart},f);f={x:f[0],y:f[1],height:f[2]||0,width:f[3]||0};return{relativePosition:f,absolutePosition:U(f,{x:f.x+l.translateX,y:f.y+l.translateY})}},itemPosition:function(m,l){var w=this.chart,u=m.points[0],v=m.options,q=l.absolutePosition,n=l.relativePosition,p;if(l=u.series.visible&&h.prototype.isInsidePane.call(u)){S(v.distance)||v.positioner?p=(v.positioner||R.getPosition).call({chart:w,distance:k(v.distance,16)},m.width,m.height,{plotX:n.x,plotY:n.y,negative:u.negative,ttBelow:u.ttBelow,h:n.height||n.width}):(u={x:q.x,y:q.y,width:0,height:0},p=this.alignedPosition(r(v,{width:m.width,height:m.height}),u),"justify"===m.options.overflow&&(p=this.alignedPosition(this.justifiedOptions(m,v,p),u))),v.crop&&(v=p.x-w.plotLeft,u=p.y-w.plotTop,l=w.isInsidePlot(v,u)&&w.isInsidePlot(v+m.width,u+m.height))}return l?p:null},alignedPosition:function(m,l){var w=m.align,u=m.verticalAlign,v=(l.x||0)+(m.x||0),q=(l.y||0)+(m.y||0),n,p;"right"===w?n=1:"center"===w&&(n=2);n&&(v+=(l.width-(m.width||0))/n);"bottom"===u?p=1:"middle"===u&&(p=2);p&&(q+=(l.height-(m.height||0))/p);return{x:Math.round(v),y:Math.round(q)}},justifiedOptions:function(x,w,v){var q=this.chart,u=w.align,p=w.verticalAlign,m=x.box?0:x.padding||0,n=x.getBBox();x={align:u,verticalAlign:p,x:w.x,y:w.y,width:x.width,height:x.height};w=v.x-q.plotLeft;var l=v.y-q.plotTop;v=w+m;0>v&&("right"===u?x.align="left":x.x=-v);v=w+n.width-m;v>q.plotWidth&&("left"===u?x.align="right":x.x=q.plotWidth-v);v=l+m;0>v&&("bottom"===p?x.verticalAlign="top":x.y=-v);v=l+n.height-m;v>q.plotHeight&&("top"===p?x.verticalAlign="bottom":x.y=q.plotHeight-v);return x},attrsFromOptions:function(l){var f=this.attrsMap,p={},m,n;for(m in l){(n=f[m])&&(p[n]=l[m])}return p}};W.extend(Q,{addAnnotation:function(l,f){var m=new e(this,l);this.annotations.push(m);this.options.annotations.push(l);k(f,!0)&&m.redraw();return m},removeAnnotation:function(l){var f=this.annotations,m=M(f,function(n){return n.options.id===l});m&&(t(this.options.annotations,m.userOptions),t(f,m),m.destroy())},drawAnnotations:function(){var l=this.plotBoxClip,f=this.plotBox;l?l.attr(f):this.plotBoxClip=this.renderer.clipRect(f);T(this.annotations,function(m){m.redraw()})}});Q.callbacks.push(function(f){f.annotations=[];T(f.options.annotations,function(l){f.annotations.push(new e(f,l))});f.drawAnnotations();V(f,"redraw",f.drawAnnotations);V(f,"destroy",function(){var l=f.plotBoxClip;l&&l.destroy&&l.destroy()})});V(W.Chart,"afterGetContainer",function(){this.options.defs=U(c,this.options.defs||{})});W.SVGRenderer.prototype.symbols.connector=function(x,w,v,q,u){var p=u&&u.anchorX;u=u&&u.anchorY;var m,n,l=v/2;d(p)&&d(u)&&(m=["M",p,u],n=w-u,0>n&&(n=-q-n),n<v&&(l=p<x+v/2?n:v-n),u>w+q?m.push("L",x+l,w+q):u<w?m.push("L",x+l,w):p<x?m.push("L",x,w+q/2):p>x+v&&m.push("L",x+v,w+q/2));return m||[]}})(a)});