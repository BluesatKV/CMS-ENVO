$(function(){$(".todoList").sortable({placeholder:"ui-state-highlight",axis:"y",revert:250,tolerance:"pointer",containment:"document",forcePlaceholderSize:true,start:function(e,ui){ui.placeholder.height(ui.item.height());ui.item.css("opacity","0.6");ui.placeholder.css("background-color","#CFF5F2")},update:function(){var arr=$(".todoList").sortable("toArray");arr=$.map(arr,function(val,key){return val.replace("todo-","")});$.get("ajax/todo.php",{action:"rearrange",positions:arr},function(data){if(data==1){$(".todo").animate({backgroundColor:"#C9FFC9"},100).animate({backgroundColor:"#F9F9F9"},1e3)}else{$(".todo").animate({backgroundColor:"#FFC9C9"},100).animate({backgroundColor:"#F9F9F9"},1e3)}})},stop:function(e,ui){ui.item.css({top:"0",left:"0"});ui.item.css("opacity","1")}});var currentTODO;$(document).on("dblclick",".todo",function(){$(this).find("a.edit").click()});$(document).on("click",".todo a",function(e){currentTODO=$(this).closest(".todo");currentTODO.data("id",currentTODO.attr("id").replace("todo-",""));e.preventDefault()});$(document).on("click",".todo a.delete",function(){$.get("ajax/todo.php",{action:"delete",id:currentTODO.data("id")},function(msg){currentTODO.fadeOut("fast")})});$(document).on("click",".todo a.done, .todo a.notdone",function(){var doneLink=$(this);var textEl="#"+currentTODO.attr("id")+" div.text";$.get("ajax/todo.php",{action:"done",id:currentTODO.data("id")},function(msg){if(doneLink.hasClass("notdone")){doneLink.removeClass("notdone").addClass("done");$(textEl).css({"text-decoration":"line-through",color:"#CCC"});console.log($(textEl).html())}else{doneLink.removeClass("done").addClass("notdone");$(textEl).css({"text-decoration":"none",color:"#626262"})}})});$(document).on("click",".todo a.edit",function(){var container=currentTODO.find(".text");if(!currentTODO.data("origText")){currentTODO.data("origText",container.text())}else{return false}$('<input type="text" class="form-control ip_xs">').val(container.text()).appendTo(container.empty());container.append('<div class="editTodo">'+'<a class="saveChanges" href="#">Save</a> or <a class="discardChanges" href="#">Cancel</a>'+"</div>")});$(document).on("click",".todo a.discardChanges",function(){currentTODO.find(".text").text(currentTODO.data("origText")).end().removeData("origText")});$(document).on("click",".todo a.saveChanges",function(){var text=currentTODO.find("input[type=text]").val();$.get("ajax/todo.php",{action:"edit",id:currentTODO.data("id"),text:text});currentTODO.removeData("origText").find(".text").text(text)});var timestamp=0;$("#addTodo").click(function(e){if((new Date).getTime()-timestamp<5e3)return false;$.get("ajax/todo.php",{action:"new",text:"New Todo Item. Doubleclick to Edit.",rand:Math.random()},function(msg){$(msg).hide().appendTo(".todoList").fadeIn()});timestamp=(new Date).getTime();$(this).timedDisable(5);e.preventDefault()})});